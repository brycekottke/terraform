{
    "version": 1,
    "serial": 9,
    "modules": [
        {
            "path": [
                "root"
            ],
            "outputs": {},
            "resources": {
                "aws_instance.dev-terraform-1": {
                    "type": "aws_instance",
                    "depends_on": [
                        "template_file.bootstrap"
                    ],
                    "primary": {
                        "id": "i-32fd45ea",
                        "attributes": {
                            "ami": "ami-9abea4fb",
                            "availability_zone": "us-west-2b",
                            "ebs_block_device.#": "0",
                            "ebs_optimized": "false",
                            "ephemeral_block_device.#": "0",
                            "iam_instance_profile": "",
                            "id": "i-32fd45ea",
                            "instance_state": "running",
                            "instance_type": "t2.micro",
                            "key_name": "bkottke-dev",
                            "monitoring": "false",
                            "private_dns": "ip-172-31-34-193.us-west-2.compute.internal",
                            "private_ip": "172.31.34.193",
                            "public_dns": "ec2-52-36-167-98.us-west-2.compute.amazonaws.com",
                            "public_ip": "52.36.167.98",
                            "root_block_device.#": "1",
                            "root_block_device.0.delete_on_termination": "true",
                            "root_block_device.0.iops": "24",
                            "root_block_device.0.volume_size": "8",
                            "root_block_device.0.volume_type": "gp2",
                            "security_groups.#": "0",
                            "source_dest_check": "true",
                            "subnet_id": "subnet-df8e33a8",
                            "tags.#": "2",
                            "tags.Name": "dev-terraform-1",
                            "tags.environment": "dev",
                            "tenancy": "default",
                            "user_data": "e8249dca19d6ce0a5154440656d455d8f807bbbc",
                            "vpc_security_group_ids.#": "1",
                            "vpc_security_group_ids.2340067433": "sg-d3cfc4b6"
                        },
                        "meta": {
                            "schema_version": "1"
                        }
                    }
                },
                "template_file.bootstrap": {
                    "type": "template_file",
                    "primary": {
                        "id": "ecf0fd81ca9e391df4ebecaa5cbfdfdbe074383b1d550d576d4ae3cf287f7c71",
                        "attributes": {
                            "id": "ecf0fd81ca9e391df4ebecaa5cbfdfdbe074383b1d550d576d4ae3cf287f7c71",
                            "rendered": "#!/bin/bash\n\n# Check if user exists. If not, create user\ncat /etc/passwd |grep datapipe\n\nif [ $? -eq 1 ]; then\n  useradd -d /home/datapipe -m -s /bin/bash datapipe\nelse\n  echo \"User 'datapipe' already exists.\"\n  exit 0\nfi\n\n# create .ssh directory\nls -la /home/datapipe |grep .ssh\n\nif [ $? -eq 1 ]; then\n  mkdir /home/datapipe/.ssh\nelse\n  echo \"Directory '.ssh' already exists.\"\n  exit 0\nfi\n\n# add key to authorized_keys file\nls -la /home/datapipe/.ssh/ |grep authorized_keys\n\nif [ $? -eq 1 ]; then\n  touch /home/datapipe/.ssh/authorized_keys\nelse\n  echo \"authorized_keys file already exists.\"\n  exit 0\nfi\n\necho ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDFAsRnbaQw2vVLpYc4eg9Y+kdcFyDCDTumJRc9ODWGjLA7HpMwB9uSYLL/oX9S9uX5Er6+Ton8eVCHBecKwKJes3N2veDcKkWR5fLKCnT2BOQyIxx6j2yERdzDvxifYQBvx8cWMlL4faMr6f01jxm/xV8eDAp+v8JStKy/YTfmwqHjsv25jT2mHnXBepImJawv6EWlzKKTB3AL/282pJFWfhbGwmSaUUEj1/2j1xjuVLi8Q+e5TCZo+rJHF6Zl4cUlJcaGh0/6tBW8CIJeCoZF5bJih/dOCUftufCKnJ9BHVepmqiCRpwW2x8T3j4+hqAtR/wGSq81WbeTwFyZPn76+82zc0/lw578KSa6R8I4gONL8y3ScgplMzay3ljUQDJZcQJJftqPk9ae1C9159wg9bXdh/6JxIlDSeY1CfH789Tzu/24is2vudIDCd+/XypXDmeu8cu8L/cgEr1pexbMe8+N9r7s2nZPfMGvnAiulXjgsoUgptNieKDf/Eb8Jpv0HFyLwUJdhiWBawXOrIkZ+/hJqe+EKgcdjtqqhY4mm+aFoC8zHHsJw3AoDWlA1412DZ0sFeRtz9uquOwekvHl8D3CxQwOeUJ0nKj4MLWsz8wdNgq53byNpzWBMiX0cLQsmDOaf8OAz5qcxMxEW104E2r5jWGLdZKc60UDHxlBFQ== bkottke3 \u003e\u003e /home/datapipe/.ssh/authorized_keys\n\n# add 'datapipe' user to sudoers\ntouch /etc/sudoers.d/datapipe\nchmod 440 /etc/sudoers.d/datapipe\n\nprintf \"# User rules for datapipe\\ndatapipe ALL=(ALL) NOPASSWD:ALL\\n\" \u003e /etc/sudoers.d/datapipe\n\n",
                            "template": "#!/bin/bash\n\n# Check if user exists. If not, create user\ncat /etc/passwd |grep datapipe\n\nif [ $? -eq 1 ]; then\n  useradd -d /home/datapipe -m -s /bin/bash datapipe\nelse\n  echo \"User 'datapipe' already exists.\"\n  exit 0\nfi\n\n# create .ssh directory\nls -la /home/datapipe |grep .ssh\n\nif [ $? -eq 1 ]; then\n  mkdir /home/datapipe/.ssh\nelse\n  echo \"Directory '.ssh' already exists.\"\n  exit 0\nfi\n\n# add key to authorized_keys file\nls -la /home/datapipe/.ssh/ |grep authorized_keys\n\nif [ $? -eq 1 ]; then\n  touch /home/datapipe/.ssh/authorized_keys\nelse\n  echo \"authorized_keys file already exists.\"\n  exit 0\nfi\n\necho ${pub_key} \u003e\u003e /home/datapipe/.ssh/authorized_keys\n\n# add 'datapipe' user to sudoers\ntouch /etc/sudoers.d/datapipe\nchmod 440 /etc/sudoers.d/datapipe\n\nprintf \"# User rules for datapipe\\ndatapipe ALL=(ALL) NOPASSWD:ALL\\n\" \u003e /etc/sudoers.d/datapipe\n\n",
                            "vars.#": "1",
                            "vars.pub_key": "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDFAsRnbaQw2vVLpYc4eg9Y+kdcFyDCDTumJRc9ODWGjLA7HpMwB9uSYLL/oX9S9uX5Er6+Ton8eVCHBecKwKJes3N2veDcKkWR5fLKCnT2BOQyIxx6j2yERdzDvxifYQBvx8cWMlL4faMr6f01jxm/xV8eDAp+v8JStKy/YTfmwqHjsv25jT2mHnXBepImJawv6EWlzKKTB3AL/282pJFWfhbGwmSaUUEj1/2j1xjuVLi8Q+e5TCZo+rJHF6Zl4cUlJcaGh0/6tBW8CIJeCoZF5bJih/dOCUftufCKnJ9BHVepmqiCRpwW2x8T3j4+hqAtR/wGSq81WbeTwFyZPn76+82zc0/lw578KSa6R8I4gONL8y3ScgplMzay3ljUQDJZcQJJftqPk9ae1C9159wg9bXdh/6JxIlDSeY1CfH789Tzu/24is2vudIDCd+/XypXDmeu8cu8L/cgEr1pexbMe8+N9r7s2nZPfMGvnAiulXjgsoUgptNieKDf/Eb8Jpv0HFyLwUJdhiWBawXOrIkZ+/hJqe+EKgcdjtqqhY4mm+aFoC8zHHsJw3AoDWlA1412DZ0sFeRtz9uquOwekvHl8D3CxQwOeUJ0nKj4MLWsz8wdNgq53byNpzWBMiX0cLQsmDOaf8OAz5qcxMxEW104E2r5jWGLdZKc60UDHxlBFQ== bkottke3"
                        }
                    }
                }
            }
        }
    ]
}
